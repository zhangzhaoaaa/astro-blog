---
/**
 * Podcast List Page
 * 
 * Displays all podcast shows from configured RSS feeds
 * Fetches data at build time for static generation
 */

import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Hr from "@components/Hr.astro";
import PodcastCard from "@components/podcast/PodcastCard";
import { getAllPodcasts } from "@utils/getPodcasts";
import type { PodcastShow } from "../../types";

// Fetch all podcasts at build time
let shows: PodcastShow[] = [];
let hasError = false;

try {
  shows = await getAllPodcasts();
  console.log(`[Podcasts Page] Fetched ${shows} shows`);
} catch (error) {
  console.error("[Podcasts Page] Failed to fetch podcasts:", error);
  hasError = true;
}

const pageTitle = "æˆ‘çš„æ’­å®¢";
const pageDesc = "æ¢ç´¢å’Œæ”¶å¬ç²¾é€‰æ’­å®¢èŠ‚ç›®";
---

<Layout title={pageTitle} description={pageDesc}>
  <Header activeNav="podcasts" />
  
  <main id="main-content" class="mx-auto w-full max-w-5xl px-4 pb-12">

    <Hr />

    {/* Error Banner */}
    {hasError && (
      <div class="my-8 rounded-lg border-2 border-red-500/20 bg-red-500/10 p-6 text-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="mx-auto mb-4 h-12 w-12 text-red-500"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <h2 class="mb-2 text-xl font-semibold text-red-500">åŠ è½½æ’­å®¢å¤±è´¥</h2>
        <p class="text-red-500/80">
          æ— æ³•è·å–RSSè®¢é˜…æºï¼Œè¯·ç¨åé‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚
        </p>
        <button
          onclick="window.location.reload()"
          class="mt-4 rounded-lg bg-red-500 px-6 py-2 font-medium text-white transition-colors hover:bg-red-600"
        >
          é‡æ–°åŠ è½½
        </button>
      </div>
    )}

    {/* Empty State */}
    {!hasError && shows.length === 0 && (
      <div class="my-12 text-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="mx-auto mb-4 h-16 w-16 text-skin-base opacity-40"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"
          />
        </svg>
        <h2 class="mb-2 text-2xl font-semibold text-skin-base opacity-60">
          æš‚æ— æ’­å®¢èŠ‚ç›®
        </h2>
        <p class="text-skin-base opacity-50">
          è¿˜æ²¡æœ‰é…ç½®RSSè®¢é˜…æºï¼Œè¯·åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ’­å®¢æºã€‚
        </p>
      </div>
    )}

    {/* Podcast Grid */}
    {!hasError && shows.length > 0 && (
      <section class="py-8">
        <div class="mb-6 text-sm text-skin-base opacity-60">
          å…± {shows.length} ä¸ªæ’­å®¢èŠ‚ç›®
        </div>
        
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {shows.map((show) => (
            <PodcastCard show={show} client:load />
          ))}
        </div>
      </section>
    )}

    {/* Additional Info */}
    {!hasError && shows.length > 0 && (
      <section class="mt-12 rounded-lg border border-skin-line bg-skin-card p-6">
        <h2 class="mb-3 text-lg font-semibold text-skin-accent">
          ğŸ’¡ ä½¿ç”¨æç¤º
        </h2>
        <ul class="space-y-2 text-sm text-skin-base opacity-80">
          <li class="flex items-start gap-2">
            <span class="mt-0.5">â€¢</span>
            <span>ç‚¹å‡»æ’­å®¢å¡ç‰‡æŸ¥çœ‹å®Œæ•´èŠ‚ç›®åˆ—è¡¨</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="mt-0.5">â€¢</span>
            <span>å¯å‰å¾€å„æ’­å®¢å¹³å°æ”¶å¬åŸèŠ‚ç›®</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="mt-0.5">â€¢</span>
            <span>æœ¬é¡µæš‚ä¸æä¾›ç«™å†…æ’­æ”¾åŠŸèƒ½</span>
          </li>
        </ul>
      </section>
    )}
  </main>

  <Footer />
</Layout>

<style>
  /* Custom styles for podcast grid animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .grid > * {
    animation: fadeInUp 0.3s ease-out backwards;
  }

  .grid > *:nth-child(1) { animation-delay: 0.05s; }
  .grid > *:nth-child(2) { animation-delay: 0.1s; }
  .grid > *:nth-child(3) { animation-delay: 0.15s; }
  .grid > *:nth-child(4) { animation-delay: 0.2s; }
  .grid > *:nth-child(5) { animation-delay: 0.25s; }
  .grid > *:nth-child(6) { animation-delay: 0.3s; }
</style>
